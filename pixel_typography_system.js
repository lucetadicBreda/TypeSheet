// ===== PIXEL TYPOGRAPHY SYSTEM =====
// Grid-based letter system for distortion effects
// Each letter uses a 9x9 pixel grid for maximum flexibility

let pixelSize = 20;
let gridCols, gridRows;
let currentText = "";
let currentFont = "sans"; // "sans" or "serif"
let distortionMode = "none"; // "none", "wave", "twist", "noise"
let distortionAmount = 0;
let animationTime = 0;

// ===== TYPOGRAPHY PATTERNS =====

// Sans Serif Font - Clean, geometric pixel style
const sansSerifFont = {
  // Uppercase Letters
  'A': [
    [0,0,0,1,1,1,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,1,1,1,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'B': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'C': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'D': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'E': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,1,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  // Lowercase Letters
  'a': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'b': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'c': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'd': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'e': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  // Numbers
  '0': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,1,1,0,0,1,1,1,0],
    [0,1,1,0,1,0,1,1,0],
    [0,1,1,1,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '1': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '2': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,0,0,0,0,1,1,0],
    [0,0,0,0,1,1,1,0,0],
    [0,0,1,1,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '3': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,0,0,0,0,1,1,0],
    [0,0,0,1,1,1,1,0,0],
    [0,0,0,0,0,0,1,1,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  // Punctuation and Symbols
  '.': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  ',': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,1,1,0,0,0,0,0]
  ],
  '!': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '?': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,0,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  ' ': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ]
};

// Serif Font - Traditional serif characteristics with pixel serifs (properly sized for 9x9 grid)
const serifFont = {
  'A': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [1,1,0,0,0,0,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'B': [
    [0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [1,1,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'C': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'D': [
    [0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,0,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,1,1,0,0,0],
    [1,1,1,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'E': [
    [0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'F': [
    [0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [1,1,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'G': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,1,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'H': [
    [0,0,0,0,0,0,0,0,0],
    [1,1,1,0,0,1,1,1,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [1,1,1,0,0,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'I': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'a': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,0,0,0,1,1,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'b': [
    [0,0,0,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,0,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'c': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'd': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,1,1,0,0,0],
    [0,0,0,0,1,1,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'e': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,1,1,0,1,1,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '0': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,1,1,1,0,0],
    [0,1,1,1,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '1': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,1,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,1,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '2': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,0,1,1,1,0,0,0],
    [0,0,1,1,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '3': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,0,1,1,1,0,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '.': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  ',': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,1,1,0,0,0,0,0]
  ],
  '!': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  '?': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,0,0,0],
    [0,1,1,0,0,1,1,0,0],
    [0,0,0,0,0,1,1,0,0],
    [0,0,0,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,1,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  ' ': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ]
};

// ===== MAIN FUNCTIONS =====

function setup() {
  createCanvas(windowWidth, windowHeight);
  gridCols = Math.floor(width / pixelSize);
  gridRows = Math.floor(height / pixelSize);
  
  // Create UI controls
  createControls();
  
  // Default text
  currentText = "Hello World!";
}

function draw() {
  background(245);
  animationTime += 0.02;
  
  // Draw grid (optional)
  drawGrid();
  
  // Render text with distortion
  renderText();
  
  // Draw UI
  drawUI();
}

// ===== TYPOGRAPHY RENDERING =====

function renderText() {
  let currentFont = (currentFont === "sans") ? sansSerifFont : serifFont;
  let letterSpacing = 9;  // Match the 9x9 grid size
  let lineHeight = 9;     // Match the 9x9 grid size
  
  // Calculate starting position (centered)
  let totalWidth = currentText.length * letterSpacing;
  let startX = Math.floor((gridCols - totalWidth) / 2);
  let startY = Math.floor(gridRows / 2) - 4;
  
  // Render each letter
  for (let i = 0; i < currentText.length; i++) {
    let char = currentText[i];
    let x = startX + i * letterSpacing;
    let y = startY;
    
    renderLetter(char, x, y, currentFont);
  }
}

function renderLetter(char, gridX, gridY, fontData) {
  let pattern = fontData[char] || fontData[' '];
  
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (pattern[row][col] === 1) {
        let pixelX = gridX + col;
        let pixelY = gridY + row;
        
        // Check bounds before applying distortion
        if (pixelX >= 0 && pixelX < gridCols && pixelY >= 0 && pixelY < gridRows) {
          // Apply distortion
          let distortedPos = applyDistortion(pixelX, pixelY);
          
          // Final bounds check after distortion
          if (distortedPos.x >= 0 && distortedPos.x < gridCols && 
              distortedPos.y >= 0 && distortedPos.y < gridRows) {
            // Draw pixel
            fill(0);
            noStroke();
            rect(distortedPos.x * pixelSize, distortedPos.y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    }
  }
}

// ===== DISTORTION EFFECTS =====

function applyDistortion(x, y) {
  let newX = x;
  let newY = y;
  
  switch(distortionMode) {
    case "wave":
      newY += sin(x * 0.3 + animationTime) * distortionAmount;
      break;
      
    case "twist":
      let centerX = gridCols / 2;
      let centerY = gridRows / 2;
      let dx = x - centerX;
      let dy = y - centerY;
      let distance = sqrt(dx * dx + dy * dy);
      let angle = atan2(dy, dx) + (distance * distortionAmount * 0.01);
      newX = centerX + cos(angle) * distance;
      newY = centerY + sin(angle) * distance;
      break;
      
    case "noise":
      newX += (noise(x * 0.1, y * 0.1, animationTime) - 0.5) * distortionAmount;
      newY += (noise(x * 0.1 + 100, y * 0.1, animationTime) - 0.5) * distortionAmount;
      break;
  }
  
  return {x: newX, y: newY};
}

// ===== UI AND CONTROLS =====

function createControls() {
  // Font toggle button
  let fontBtn = createButton('Toggle Font');
  fontBtn.position(20, 20);
  fontBtn.mousePressed(() => {
    currentFont = (currentFont === "sans") ? "serif" : "sans";
  });
  
  // Distortion mode buttons
  let waveBtn = createButton('Wave');
  waveBtn.position(20, 60);
  waveBtn.mousePressed(() => distortionMode = "wave");
  
  let twistBtn = createButton('Twist');
  twistBtn.position(80, 60);
  twistBtn.mousePressed(() => distortionMode = "twist");
  
  let noiseBtn = createButton('Noise');
  noiseBtn.position(140, 60);
  noiseBtn.mousePressed(() => distortionMode = "noise");
  
  let noneBtn = createButton('None');
  noneBtn.position(200, 60);
  noneBtn.mousePressed(() => distortionMode = "none");
}

function drawGrid() {
  stroke(200);
  strokeWeight(0.5);
  
  // Vertical lines
  for (let x = 0; x <= width; x += pixelSize) {
    line(x, 0, x, height);
  }
  
  // Horizontal lines
  for (let y = 0; y <= height; y += pixelSize) {
    line(0, y, width, y);
  }
}

function drawUI() {
  fill(0);
  textSize(14);
  text(`Font: ${currentFont}`, 20, height - 60);
  text(`Distortion: ${distortionMode}`, 20, height - 40);
  text(`Amount: ${distortionAmount.toFixed(1)}`, 20, height - 20);
  text('Type to change text. Use mouse wheel to adjust distortion.', 20, height - 100);
}

// ===== INPUT HANDLING =====

function keyPressed() {
  if (keyCode === BACKSPACE) {
    currentText = currentText.slice(0, -1);
  } else if (keyCode === ENTER) {
    // Could add line breaks here
  } else if (key.length === 1) {
    currentText += key;
  }
}

function mouseWheel(event) {
  distortionAmount += event.delta * 0.1;
  distortionAmount = constrain(distortionAmount, 0, 10);
  return false;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  gridCols = Math.floor(width / pixelSize);
  gridRows = Math.floor(height / pixelSize);
}

// ===== UTILITY FUNCTIONS =====

function addLetterToFont(fontObj, char, pattern) {
  fontObj[char] = pattern;
}

// Function to create custom letters
function createCustomLetter() {
  return [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ];
}
