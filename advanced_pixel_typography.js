// Advanced Pixel Typography System for p5.js
// Fixed grid with variable pixel density for different letter sizes
// Supports distortion effects while maintaining grid boundaries

// ===== CONFIGURATION =====
let canvas;
let pixelSize = 16;
let gridCols, gridRows;
let currentText = "HI";
let currentFont = "sans";
let currentSize = "medium";
let distortionMode = "none";
let distortionAmount = 2;
let animationTime = 0;
let showGrid = true;

// Make variables globally accessible for UI controls
window.currentFont = currentFont;
window.currentSize = currentSize;

// Font sizes with different pixel densities
const fontSizes = {
  small: { density: 1, width: 5, height: 7 },    // 5x7 grid, 1x1 pixel per unit
  medium: { density: 3, width: 5, height: 7 },   // 5x7 grid, 3x3 pixels per unit  
  large: { density: 5, width: 5, height: 7 }     // 5x7 grid, 5x5 pixels per unit
};

// ===== SANS SERIF FONT DEFINITIONS =====
// Small size (5x7) - 1 pixel density - COMPLETE CHARACTER SET
const sansSerifSmall = {
  // Uppercase A-Z
  'A': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'B': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  'C': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'D': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  'E': [[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  'F': [[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],
  'G': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'H': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'I': [[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  'J': [[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'K': [[1,0,0,0,1],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,1],[0,0,0,0,0]],
  'L': [[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  'M': [[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'N': [[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'O': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'P': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],
  'Q': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[0,1,1,1,1],[0,0,0,0,0]],
  'R': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,1,0,0],[1,0,0,1,1],[0,0,0,0,0]],
  'S': [[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  'T': [[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],
  'U': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'V': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,0,0,0]],
  'W': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1],[0,0,0,0,0]],
  'X': [[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'Y': [[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],
  'Z': [[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  
  // Lowercase a-z
  'a': [[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,1,1,1,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,0]],
  'b': [[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  'c': [[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'd': [[0,0,0,0,1],[0,0,0,0,1],[0,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,0]],
  'e': [[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0]],
  'f': [[0,0,1,1,0],[0,1,0,0,0],[1,1,1,1,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,0,0,0]],
  'g': [[0,0,0,0,0],[0,1,1,1,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'h': [[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'i': [[0,0,1,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0],[0,0,0,0,0]],
  'j': [[0,0,0,1,0],[0,0,0,0,0],[0,0,1,1,0],[0,0,0,1,0],[0,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0]],
  'k': [[1,0,0,0,0],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,0],[0,0,0,0,0]],
  'l': [[1,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,0,0,0,0]],
  'm': [[0,0,0,0,0],[1,1,0,1,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'n': [[0,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],
  'o': [[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'p': [[0,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],
  'q': [[0,0,0,0,0],[0,1,1,1,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,0]],
  'r': [[0,0,0,0,0],[1,0,1,1,0],[1,1,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],
  's': [[0,0,0,0,0],[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  't': [[0,1,0,0,0],[1,1,1,1,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,1,1,0],[0,0,0,0,0]],
  'u': [[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,0]],
  'v': [[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,0,0,0]],
  'w': [[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1],[0,0,0,0,0]],
  'x': [[0,0,0,0,0],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[0,0,0,0,0]],
  'y': [[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  'z': [[0,0,0,0,0],[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  
  // Numbers 0-9
  '0': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,1,1],[1,0,1,0,1],[1,1,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  '1': [[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0],[0,0,0,0,0]],
  '2': [[0,1,1,1,0],[1,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1],[0,0,0,0,0]],
  '3': [[1,1,1,1,0],[0,0,0,0,1],[0,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  '4': [[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,1,1],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,0,0]],
  '5': [[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0],[0,0,0,0,0]],
  '6': [[0,1,1,1,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  '7': [[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],
  '8': [[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  '9': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,1,1,1,0],[0,0,0,0,0]],
  
  // Common symbols
  '.': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,0,0,0]],
  ',': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,1,0,0,0]],
  '!': [[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]],
  '?': [[0,1,1,1,0],[1,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]],
  ':': [[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],
  ';': [[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,0,0,0],[0,0,0,0,0]],
  '-': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],
  '+': [[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],
  ' ': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]
};

// Medium size (9x12) - 2x2 pixel density
const sansSerifMedium = {
  'A': [
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,0,0,0,1,1,0],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,1,1,1,1,1,1,1],
    [1,1,1,1,1,1,1,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'B': [
    [1,1,1,1,1,1,1,0,0],
    [1,1,1,1,1,1,1,1,0],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,1,1,1,1,1,1,0],
    [1,1,1,1,1,1,1,0,0],
    [1,1,0,0,0,0,1,1,0],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'H': [
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,1,1,1,1,1,1,1],
    [1,1,1,1,1,1,1,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'O': [
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,1,1,1,1,1,0],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [1,1,0,0,0,0,0,1,1],
    [0,1,1,1,1,1,1,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  ' ': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ]
};

// ===== SERIF FONT DEFINITIONS =====
// Small serif (5x7) with decorative elements - STRICTLY WITHIN BOUNDS
const serifSmall = {
  'A': [
    [0,0,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'B': [
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,0,0,0,0]
  ],
  'C': [
    [0,0,1,1,1],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,0,1,1,1],
    [0,0,0,0,0]
  ],
  'D': [
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,0,0,0,0]
  ],
  'E': [
    [0,1,1,1,1],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,1,1,0],
    [0,1,0,0,0],
    [0,1,1,1,1],
    [0,0,0,0,0]
  ],
  'F': [
    [0,1,1,1,1],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,1,1,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,0,0,0,0]
  ],
  'G': [
    [0,0,1,1,1],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,1,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  'H': [
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'I': [
    [0,0,1,1,1],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,1,1,1],
    [0,0,0,0,0]
  ],
  'J': [
    [0,0,0,0,1],
    [0,0,0,0,1],
    [0,0,0,0,1],
    [0,0,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  'K': [
    [0,1,0,0,1],
    [0,1,0,1,0],
    [0,1,1,0,0],
    [0,1,0,0,0],
    [0,1,0,1,0],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'L': [
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,1,1,1],
    [0,0,0,0,0]
  ],
  'M': [
    [0,1,0,0,1],
    [0,1,1,1,1],
    [0,1,0,1,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'N': [
    [0,1,0,0,1],
    [0,1,1,0,1],
    [0,1,0,1,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'O': [
    [0,0,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  'P': [
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,0,0,0,0]
  ],
  'Q': [
    [0,0,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,1,1],
    [0,1,0,0,1],
    [0,0,1,1,1],
    [0,0,0,0,0]
  ],
  'R': [
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,1,0,1,0],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'S': [
    [0,0,1,1,1],
    [0,1,0,0,0],
    [0,0,1,0,0],
    [0,0,0,1,0],
    [0,0,0,0,1],
    [0,1,1,1,0],
    [0,0,0,0,0]
  ],
  'T': [
    [0,1,1,1,1],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,0,0]
  ],
  'U': [
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  'V': [
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,1,0],
    [0,0,0,0,0]
  ],
  'W': [
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,0,1,1],
    [0,1,1,1,1],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'X': [
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,1,0],
    [0,0,1,0,0],
    [0,1,0,1,0],
    [0,1,0,0,1],
    [0,0,0,0,0]
  ],
  'Y': [
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,1,0],
    [0,0,0,0,0]
  ],
  'Z': [
    [0,1,1,1,1],
    [0,0,0,0,1],
    [0,0,0,1,0],
    [0,0,1,0,0],
    [0,1,0,0,0],
    [0,1,1,1,1],
    [0,0,0,0,0]
  ],
  
  // Lowercase
  'a': [
    [0,0,0,0,0],
    [0,0,1,1,0],
    [0,0,0,0,1],
    [0,0,1,1,1],
    [0,1,0,0,1],
    [0,0,1,1,1],
    [0,0,0,0,0]
  ],
  'b': [
    [0,1,0,0,0],
    [0,1,0,0,0],
    [0,1,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,1,1,1,0],
    [0,0,0,0,0]
  ],
  'c': [
    [0,0,0,0,0],
    [0,0,1,1,0],
    [0,1,0,0,1],
    [0,1,0,0,0],
    [0,1,0,0,1],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  'd': [
    [0,0,0,0,1],
    [0,0,0,0,1],
    [0,0,1,1,1],
    [0,1,0,0,1],
    [0,1,0,0,1],
    [0,0,1,1,1],
    [0,0,0,0,0]
  ],
  'e': [
    [0,0,0,0,0],
    [0,0,1,1,0],
    [0,1,0,0,1],
    [0,1,1,1,1],
    [0,1,0,0,0],
    [0,0,1,1,0],
    [0,0,0,0,0]
  ],
  ' ': [
    [0,0,0,0,0],
    [0,0,0,0,0],
    [0,0,0,0,0],
    [0,0,0,0,0],
    [0,0,0,0,0],
    [0,0,0,0,0],
    [0,0,0,0,0]
  ]
};

// Medium serif (9x12) with decorative elements - STRICTLY WITHIN BOUNDS
const serifMedium = {
  'A': [
    [0,0,0,1,1,1,0,0,0],
    [0,0,1,0,0,0,1,0,0],
    [0,0,1,0,0,0,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'B': [
    [1,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [1,1,1,1,1,1,1,0,0],
    [1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'C': [
    [0,0,1,1,1,1,1,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,1],
    [0,0,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'D': [
    [1,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [1,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'E': [
    [1,1,1,1,1,1,1,1,1],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'F': [
    [1,1,1,1,1,1,1,1,1],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'G': [
    [0,0,1,1,1,1,1,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,1,1,1,0,0],
    [1,0,0,0,0,0,0,1,0],
    [1,0,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,0,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'H': [
    [1,1,0,0,0,0,0,1,1],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'I': [
    [0,1,1,1,1,1,1,1,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,1,1,1,1,1,1,1,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'J': [
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'K': [
    [1,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,1,0,0],
    [0,1,0,0,0,1,0,0,0],
    [0,1,0,0,1,0,0,0,0],
    [0,1,0,1,0,0,0,0,0],
    [0,1,1,0,0,0,0,0,0],
    [0,1,0,1,0,0,0,0,0],
    [0,1,0,0,1,0,0,0,0],
    [0,1,0,0,0,1,0,0,0],
    [0,1,0,0,0,0,1,0,0],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'L': [
    [1,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'M': [
    [1,0,0,0,0,0,0,0,1],
    [1,1,0,0,0,0,0,1,1],
    [1,0,1,0,0,0,1,0,1],
    [1,0,0,1,0,1,0,0,1],
    [1,0,0,0,1,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'N': [
    [1,1,0,0,0,0,0,1,1],
    [0,1,1,0,0,0,0,1,0],
    [0,1,0,1,0,0,0,1,0],
    [0,1,0,0,1,0,0,1,0],
    [0,1,0,0,0,1,0,1,0],
    [0,1,0,0,0,0,1,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'O': [
    [0,0,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'P': [
    [1,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [1,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'Q': [
    [0,0,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,1,0,0,1],
    [1,0,0,0,0,0,1,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,1,1,1,1,0,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'R': [
    [1,1,1,1,1,1,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,1,0,0,1,0,0,0,0],
    [0,1,0,0,0,1,0,0,0],
    [0,1,0,0,0,0,1,0,0],
    [1,1,0,0,0,0,0,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'S': [
    [0,0,1,1,1,1,1,1,0],
    [0,1,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,0,0,1],
    [0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,1,0],
    [0,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'T': [
    [1,1,1,1,1,1,1,1,1],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'U': [
    [1,1,0,0,0,0,0,1,1],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'V': [
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,0,0,0,1,0,0],
    [0,0,1,0,0,0,1,0,0],
    [0,0,0,1,0,1,0,0,0],
    [0,0,0,1,0,1,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'W': [
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,1,0,0,0,1],
    [1,0,0,1,0,1,0,0,1],
    [1,0,1,0,0,0,1,0,1],
    [1,1,0,0,0,0,0,1,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'X': [
    [1,0,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,0,0,0,1,0,0],
    [0,0,0,1,0,1,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,1,0,1,0,0,0],
    [0,0,1,0,0,0,1,0,0],
    [0,1,0,0,0,0,0,1,0],
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  'Y': [
    [1,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,0],
    [0,0,1,0,0,0,1,0,0],
    [0,0,0,1,0,1,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0]
  ],
  'Z': [
    [1,1,1,1,1,1,1,1,1],
    [0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,1,0,0],
    [0,0,0,0,0,1,0,0,0],
    [0,0,0,0,1,0,0,0,0],
    [0,0,0,1,0,0,0,0,0],
    [0,0,1,0,0,0,0,0,0],
    [0,1,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1],
    [0,0,0,0,0,0,0,0,0]
  ],
  ' ': [
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0]
  ]
};

// Medium serif (9x12) with enhanced serifs - FIXED GRID BOUNDARIES

// ===== CORE FUNCTIONS =====

function setup() {
  canvas = createCanvas(1200, 800);
  canvas.parent('canvas-container');
  
  gridCols = Math.floor(width / pixelSize);
  gridRows = Math.floor(height / pixelSize);
  
  // Sync with window variables
  syncVariables();
  
  console.log(`Grid: ${gridCols} x ${gridRows}`);
}

// Sync variables between p5.js and window
function syncVariables() {
  window.currentFont = currentFont;
  window.currentSize = currentSize;
}

// Check for variable changes from UI
function checkVariableChanges() {
  if (window.currentFont !== currentFont) {
    currentFont = window.currentFont;
  }
  if (window.currentSize !== currentSize) {
    currentSize = window.currentSize;
  }
}

function draw() {
  background(240);
  animationTime += 0.02;
  
  // Check for UI variable changes
  checkVariableChanges();
  
  if (showGrid) {
    drawGrid();
  }
  
  renderText();
  drawUI();
}

function getFontData() {
  if (currentFont === "sans") {
    // Always use small font pattern, scale with density
    return sansSerifSmall;
  } else {
    // Always use small serif pattern, scale with density
    return serifSmall;
  }
}

function renderText() {
  let fontData = getFontData();
  let sizeConfig = fontSizes[currentSize];
  let letterSpacing = (sizeConfig.width * sizeConfig.density) + 1;
  
  // Calculate starting position (centered)
  let totalWidth = currentText.length * letterSpacing;
  let startX = Math.floor((gridCols - totalWidth) / 2);
  let startY = Math.floor((gridRows - (sizeConfig.height * sizeConfig.density)) / 2);
  
  // Render each letter
  for (let i = 0; i < currentText.length; i++) {
    let char = currentText[i];
    let x = startX + i * letterSpacing;
    let y = startY;
    
    renderLetter(char, x, y, fontData, sizeConfig);
  }
}

function renderLetter(char, gridX, gridY, fontData, sizeConfig) {
  let pattern = fontData[char] || fontData[' '];
  if (!pattern) return;
  
  let density = sizeConfig.density;
  
  for (let row = 0; row < pattern.length; row++) {
    for (let col = 0; col < pattern[row].length; col++) {
      if (pattern[row][col] === 1) {
        // Render with pixel density
        for (let dy = 0; dy < density; dy++) {
          for (let dx = 0; dx < density; dx++) {
            let pixelX = gridX + col * density + dx;
            let pixelY = gridY + row * density + dy;
            
            // Check bounds
            if (pixelX >= 0 && pixelX < gridCols && pixelY >= 0 && pixelY < gridRows) {
              // Apply distortion
              let distortedPos = applyDistortion(pixelX, pixelY);
              
              // Final bounds check
              if (distortedPos.x >= 0 && distortedPos.x < gridCols && 
                  distortedPos.y >= 0 && distortedPos.y < gridRows) {
                // Draw pixel
                fill(0);
                noStroke();
                rect(distortedPos.x * pixelSize, distortedPos.y * pixelSize, pixelSize, pixelSize);
              }
            }
          }
        }
      }
    }
  }
}

// ===== DISTORTION EFFECTS =====

function applyDistortion(x, y) {
  let newX = x;
  let newY = y;
  
  switch(distortionMode) {
    case "wave":
      newY += sin(x * 0.3 + animationTime) * distortionAmount;
      break;
      
    case "twist":
      let centerX = gridCols / 2;
      let centerY = gridRows / 2;
      let distance = dist(x, y, centerX, centerY);
      let angle = atan2(y - centerY, x - centerX);
      angle += (distance * 0.02 + animationTime) * distortionAmount * 0.1;
      newX = centerX + cos(angle) * distance;
      newY = centerY + sin(angle) * distance;
      break;
      
    case "noise":
      newX += (noise(x * 0.1, y * 0.1, animationTime) - 0.5) * distortionAmount;
      newY += (noise(x * 0.1 + 100, y * 0.1 + 100, animationTime) - 0.5) * distortionAmount;
      break;
      
    case "ripple":
      let cx = gridCols / 2;
      let cy = gridRows / 2;
      let d = dist(x, y, cx, cy);
      let offset = sin(d * 0.2 - animationTime * 2) * distortionAmount;
      let angle2 = atan2(y - cy, x - cx);
      newX = x + cos(angle2) * offset;
      newY = y + sin(angle2) * offset;
      break;
      
    default:
      // No distortion
      break;
  }
  
  return { x: newX, y: newY };
}

// ===== UI AND UTILITIES =====

function drawGrid() {
  stroke(200);
  strokeWeight(0.5);
  
  // Vertical lines
  for (let x = 0; x <= width; x += pixelSize) {
    line(x, 0, x, height);
  }
  
  // Horizontal lines
  for (let y = 0; y <= height; y += pixelSize) {
    line(0, y, width, y);
  }
}

function drawUI() {
  // Background for UI
  fill(0, 0, 0, 150);
  noStroke();
  rect(10, 10, 300, 220);
  
  // UI Text
  fill(255);
  textSize(14);
  textAlign(LEFT);
  
  text("Advanced Pixel Typography System", 20, 30);
  text(`Text: ${currentText}`, 20, 50);
  text(`Font: ${currentFont} (${currentSize})`, 20, 70);
  text(`Distortion: ${distortionMode} (${distortionAmount})`, 20, 90);
  text(`Grid: ${gridCols} x ${gridRows}`, 20, 110);
  
  // Size buttons
  fill(255, 255, 0); // Yellow background
  stroke(0);
  strokeWeight(2);
  
  // Small button
  rect(20, 130, 80, 25);
  fill(0);
  noStroke();
  textAlign(CENTER);
  text("SMALL", 60, 147);
  
  // Medium button  
  fill(currentSize === "medium" ? color(0, 255, 0) : color(255, 255, 0));
  stroke(0);
  strokeWeight(2);
  rect(110, 130, 80, 25);
  fill(0);
  noStroke();
  text("MEDIUM", 150, 147);
  
  // Large button
  fill(currentSize === "large" ? color(0, 255, 0) : color(255, 255, 0));
  stroke(0);
  strokeWeight(2);
  rect(200, 130, 80, 25);
  fill(0);
  noStroke();
  text("LARGE", 240, 147);
  
  // Instructions
  fill(255);
  textAlign(LEFT);
  text("Click buttons above to change size!", 20, 175);
  text("Controls:", 20, 195);
  text("Type to edit text", 20, 210);
  text("F = Font toggle, 1-4 = Distortion", 20, 225);
}

// ===== EVENT HANDLERS =====

function keyPressed() {
  if (key === 'f' || key === 'F') {
    currentFont = (currentFont === "sans") ? "serif" : "sans";
  }
  else if (key === 's' || key === 'S') {
    if (currentSize === "small") currentSize = "medium";
    else if (currentSize === "medium") currentSize = "large";
    else currentSize = "small";
  }
  else if (key === 'g' || key === 'G') {
    showGrid = !showGrid;
  }
  else if (key === '1') {
    distortionMode = "none";
  }
  else if (key === '2') {
    distortionMode = "wave";
  }
  else if (key === '3') {
    distortionMode = "twist";
  }
  else if (key === '4') {
    distortionMode = "noise";
  }
  else if (key === '5') {
    distortionMode = "ripple";
  }
  else if (keyCode === BACKSPACE) {
    if (currentText.length > 0) {
      currentText = currentText.slice(0, -1);
    }
  }
  else if (key.length === 1 && currentText.length < 20) {
    currentText += key.toUpperCase();
  }
}

function mousePressed() {
  // Check if mouse is over size buttons
  if (mouseY >= 130 && mouseY <= 155) {
    // Small button (20-100)
    if (mouseX >= 20 && mouseX <= 100) {
      currentSize = "small";
      window.currentSize = "small";
    }
    // Medium button (110-190)  
    else if (mouseX >= 110 && mouseX <= 190) {
      currentSize = "medium";
      window.currentSize = "medium";
    }
    // Large button (200-280)
    else if (mouseX >= 200 && mouseX <= 280) {
      currentSize = "large";
      window.currentSize = "large";
    }
  }
}

function mouseWheel(event) {
  distortionAmount = constrain(distortionAmount + event.delta * 0.01, 0, 10);
  return false;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  gridCols = Math.floor(width / pixelSize);
  gridRows = Math.floor(height / pixelSize);
}
